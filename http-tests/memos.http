###
# ==============================================================================
# Onix Memo API Test (with Authorization)
# ==============================================================================

###
# STEP 0-A: 테스트용 사용자 A 생성 (이미 존재하면 409 Conflict, 괜찮음)
# @name createUserA
POST http://localhost:3000/users
Content-Type: application/json

{
  "email": "user-a@test.com",
  "password": "password-a"
}

###
# STEP 0-B: 테스트용 사용자 B 생성 (이미 존재하면 409 Conflict, 괜찮음)
# @name createUserB
POST http://localhost:3000/users
Content-Type: application/json

{
  "email": "user-b@test.com",
  "password": "password-b"
}

###
# ==============================================================================
# TEST SCENARIO: A가 만든 메모를 B가 조회/수정/삭제할 수 없는가?
# ==============================================================================

###
# STEP 1: 사용자 A로 로그인
# @name loginA
POST http://localhost:3000/auth/login
Content-Type: application/json

{
  "email": "user-a@test.com",
  "password": "password-a"
}

> {%
    client.global.set('token_A', response.body.access_token);
%}

###
# STEP 2: 사용자 A로 메모 생성
# @name createMemoByA
POST http://localhost:3000/memos
Content-Type: application/json
Authorization: Bearer {{token_A}}

{
  "title": "A가 작성한 비밀 메모",
  "content": "이 내용은 B가 보면 안됩니다."
}

> {%
    client.global.set('memo_id_by_A', response.body.id);
%}


###
# STEP 3: 사용자 B로 로그인
# @name loginB
POST http://localhost:3000/auth/login
Content-Type: application/json

{
  "email": "user-b@test.com",
  "password": "password-b"
}

> {%
    client.global.set('token_B', response.body.access_token);
%}


###
# STEP 4: [핵심 테스트] 사용자 B가 사용자 A의 메모 조회를 시도 (403 Forbidden 예상)
# @name getMemoByB
GET http://localhost:3000/memos/{{memo_id_by_A}}
Authorization: Bearer {{token_B}}


###
# ==============================================================================
# 부가 테스트: 자기 자신의 메모는 잘 조회되는가?
# ==============================================================================

###
# STEP 5: 사용자 A가 자기 메모 조회를 시도 (200 OK 예상)
# @name getMemoByA
GET http://localhost:3000/memos/{{memo_id_by_A}}
Authorization: Bearer {{token_A}}